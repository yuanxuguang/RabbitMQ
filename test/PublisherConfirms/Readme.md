### 1. 发布确认原理

    生产者将信道设置成confirm模式，一旦信道进入confirm模式，所有在该信道上面发布的
    消息都将会被指派一个唯一的ID(从1开始)，一旦消息被投递到所有匹配的队列之后，broker
    就会发送一个确认给生产者(包含消息的唯一ID)，这就使得生产者知道消息已经正确到达目的队
    列了，如果消息和队列是可持久化的，那么确认消息会在将消息写入磁盘之后发出，broker回传
    给生产者的确认消息中delivery-tag域包含了确认消息的序列号，此外broker也可以设置
    basic.ack 的 multiple 域，表示到这个序列号之前的所有消息都已经得到了处理。 
    confirm 模式最大的好处在于他是异步的，一旦发布一条消息，生产者应用程序就可以在等信
    道返回确认的同时继续发送下一条消息，当消息最终得到确认之后，生产者应用便可以通过回调
    方法来处理该确认消息，如果RabbitMQ因为自身内部错误导致消息丢失，就会发送一条nack消
    息，生产者应用程序同样可以在回调方法中处理该nack消息。 

### 2. 发布确认的策略 

#### 2.1. 开启发布确认的方法

发布确认默认是没有开启的，如果要开启需要调用方法confirmSelect，每当你要想使用发布
确认，都需要在channel上调用该方法

```PHP
$connection = new AMQPStreamConnection('localhost', 5672, 'guest', 'guest');
$channel = $connection->channel();
$channel->confirm_select(); // 开启发布确认模式
```
#### 2.2 单个确认发布 [同步阻塞]

这是一种简单的确认方式，它是一种同步确认发布的方式，也就是发布一个消息之后只有它
被确认发布，后续的消息才能继续发布,waitForConfirmsOrDie(long)这个方法只有在消息被确认
的时候才返回，如果在指定时间范围内这个消息没有被确认那么它将抛出异常。 
这种确认方式有一个最大的缺点就是:发布速度特别的慢，因为如果没有确认发布的消息就会
阻塞所有后续消息的发布，这种方式最多提供每秒不超过数百条发布消息的吞吐量。当然对于某
些应用程序来说这可能已经足够了。 